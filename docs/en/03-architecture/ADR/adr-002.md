# ADR-002: Choosing DynamoDB as Database

**Status:** Accepted  
**Date:** 2025-10-22  
**Participants:** Developer, course instructors

## 1. Context and Problem

"Which database should be used for storing movie viewing entries (diary entries) and movie information in the Vulpecula application to ensure performance (response time ‚â§500 ms), scalability, and gain practical experience with the target employer's technology stack?"

## 2. Architecturally Significant Requirements (ASR)

| Requirement ID | Requirement Text | Type | Source |
|----------------|------------------|------|--------|
| PERF-001 | API response time ‚â§500 ms for database queries | NFR | Technical specification |
| PERF-002 | Query optimization for fast retrieval of viewing data | NFR | Technical specification |
| SCAL-002 | Support for data growth up to 1000+ entries per user | NFR | Functional requirements |
| CAREER-001 | Gaining practical experience with target employer's technology stack (DynamoDB + AWS) | NFR | Career goals |
| COST-001 | Minimizing costs for educational project | NFR | Budget constraints |
| REL-001 | Data storage reliability, no data loss | NFR | Technical specification |

## 3. Analysis of Alternatives

| Requirement \ Solution | PostgreSQL (RDS) | MongoDB (Atlas) | DynamoDB |
|------------------------|------------------|-----------------|----------|
| PERF-001 | ‚úÖ ~100ms with indexes | ‚úÖ ~80ms | ‚úÖ ~10ms (single-digit latency) |
| PERF-002 | ‚úÖ SQL optimization | ‚úÖ Aggregation pipeline | ‚úÖ Partition keys |
| SCAL-002 | ‚ö†Ô∏è Requires scaling | ‚úÖ Auto-scaling | ‚úÖ Seamless scaling |
| CAREER-001 | ‚ùå | ‚ùå | ‚úÖ Used by target employer |
| COST-001 | ‚ö†Ô∏è $30-50/month (RDS) | ‚ö†Ô∏è $25-40/month | ‚úÖ Free tier + ~$5/month |
| REL-001 | ‚úÖ ACID | ‚úÖ | ‚úÖ 99.99% availability SLA |
| Schema complexity | ‚úÖ Relational model | ‚úÖ Document model | ‚ö†Ô∏è Requires access pattern planning |
| AWS integration | ‚ö†Ô∏è Requires RDS | ‚ö†Ô∏è External service | ‚úÖ Native integration |
| Backup | ‚úÖ | ‚úÖ | ‚úÖ Point-in-time recovery |

## 4. Selected Solution

**Amazon DynamoDB** with:
* Single Table Design for query optimization
* Partition Key: `userId`, Sort Key: `viewingDate#movieId` for viewing entries
* GSI (Global Secondary Index) for queries by movieId
* On-Demand pricing for educational project
* DynamoDB Streams for future feature expansion

**Table structure:**
```
PK (Partition Key): USER#<userId> | MOVIE#<movieId>
SK (Sort Key): DIARY#<timestamp>#<entryId> | METADATA
```

## 5. Rationale

The solution satisfies all critical requirements:

* **PERF-001**: DynamoDB provides single-digit millisecond latency (< 10ms) for read/write operations
* **PERF-002**: Properly designed partition and sort keys enable efficient queries without table scans
* **SCAL-002**: DynamoDB automatically scales with data growth without manual configuration
* **CAREER-001**: Target company actively uses DynamoDB in production. Practical experience with Single Table Design and query optimization is valuable for employment
* **COST-001**: AWS Free Tier covers 25GB storage and 200M requests/month, sufficient for educational project
* **REL-001**: AWS guarantees 99.99% availability and automatic backups

Additional advantages:
* Native integration with AWS Lambda - minimal latency
* No infrastructure management required (serverless)
* Automatic data encryption
* Point-in-time recovery for data loss protection

## 6. Consequences

* ‚úÖ **Positive:**
    * Minimal infrastructure costs for educational project
    * Experience working with NoSQL and Single Table Design
    * Fast development without database setup
    * Relevant experience for target employer
    * High performance for application access patterns
    * Seamless scaling with load growth

* ‚ö†Ô∏è **Negative:**
    * Requires careful access pattern design at planning stage
    * Limited flexibility for ad-hoc queries (not suitable for analytics)
    * Difficulty changing data structure after initial use
    * Need to learn NoSQL concepts and DynamoDB-specific patterns

* üîß **Dependencies:**
    * ADR-001: Ktor integration with AWS SDK for DynamoDB
    * ADR-004: TMDb data caching strategy in DynamoDB

## 7. Verification

| Requirement | Verification Method | Result | Status |
|-------------|---------------------|--------|--------|
| PERF-001 | Load testing (100 requests) | p95 = 15ms for GetItem | ‚úÖ |
| PERF-002 | Query operation testing | Viewing history retrieval < 50ms | ‚úÖ |
| SCAL-002 | Test with 10,000 entries per user | Performance does not degrade | ‚úÖ |
| CAREER-001 | Tech stack alignment with target company | DynamoDB + Single Table Design | ‚úÖ |
| COST-001 | Cost analysis (1 month testing) | $0 (within Free Tier) | ‚úÖ |
| REL-001 | Backup recovery test | Successful Point-in-time recovery | ‚úÖ |