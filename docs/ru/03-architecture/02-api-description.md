# Описание API

## 1. Сущности

### Entry (Запись в дневнике)

| Поле | Бизнес-описание | Пример значения |
|------|-----------------|-----------------|
| id | Уникальный идентификатор записи | "446655440000" |
| userId | Идентификатор пользователя (владельца записи) | "user:12345" |
| movieId | Идентификатор фильма из базы данных | "movie:tt0111161" |
| movieTitle | Название фильма | "The Shawshank Redemption" |
| viewingDate | Дата просмотра | "2025-10-15" |
| rating | Оценка фильма (1-10) | 9 |
| comment | Комментарий пользователя | "Потрясающий фильм о надежде" |
| createdAt | Дата создания записи | "2025-10-15T20:30:00Z" |
| updatedAt | Дата последнего обновления | "2025-10-16T10:00:00Z" |

### Movie (Фильм)

| Поле | Бизнес-описание | Пример значения |
|------|-----------------|-----------------|
| id | Уникальный идентификатор фильма | "movie:tt0111161" |
| title | Название фильма | "The Shawshank Redemption" |
| releaseYear | Год выпуска | 1994 |
| director | Режиссер | "Frank Darabont" |
| cast | Главные актеры | ["Tim Robbins", "Morgan Freeman"] |
| genre | Жанры | ["Drama", "Crime"] |
| description | Краткое описание | "A banker is wrongfully convicted..." |
| posterUrl | URL постера фильма | "https://image.tmdb.org/..." |
| tmdbId | ID фильма в TMDb | "278" |

## 2. Бизнес-функции (методы)

### CRUDS для записей о просмотрах

1. **`entry.create`** - Создание новой записи о просмотре
   * Бизнес-правило: Только аутентифицированные пользователи могут создавать записи
   * Ограничения:
      * Обязательные поля: movieId, viewingDate
      * Оценка должна быть в диапазоне 1-10
      * Дата просмотра не может быть в будущем
   * Валидация: Проверка существования фильма в базе данных

2. **`entry.read`** - Получение информации о записи
   * Бизнес-правило: Пользователь может просматривать только свои записи
   * Возвращает: Полную информацию о записи с данными о фильме

3. **`entry.update`** - Обновление существующей записи
   * Бизнес-правило: Только владелец может изменять свою запись
   * Ограничения: Нельзя изменить userId и movieId
   * Валидация: Проверка прав доступа

4. **`entry.delete`** - Удаление записи
   * Бизнес-правило: Только владелец может удалить свою запись
   * Возвращает: Статус успешного удаления

5. **`entry.search`** - Поиск записей пользователя по критериям
   * Бизнес-логика: Возвращает записи текущего пользователя с применением фильтров
   * Фильтры:
      - По конкретному фильму (movieId)
      - По диапазону дат просмотра (dateFrom, dateTo)
      - По оценке (rating)
   * Сортировка: По дате просмотра (по умолчанию: от новых к старым), по оценке
   * Возвращает: Список записей, соответствующих критериям поиска
   * Использование: Универсальный метод для получения списка записей и истории повторных просмотров

### CRUDS для фильмов

6. **`movie.create`** (только для администраторов) - Добавление фильма в базу
   * Бизнес-правило: Только администраторы могут добавлять фильмы вручную
   * Валидация: Проверка на дубликаты
   * Использование: Для добавления фильмов, отсутствующих в TMDb

7. **`movie.read`** - Получение детальной информации о фильме
   * Бизнес-логика: Возвращает полную информацию о фильме из локальной базы данных
   * Возвращает: Детальную информацию о фильме

8. **`movie.update`** (только для администраторов) - Обновление информации о фильме
   * Бизнес-правило: Только администраторы могут редактировать информацию о фильмах
   * Использование: Для исправления ошибок или обновления данных

9. **`movie.delete`** (только для администраторов) - Удаление фильма из базы
   * Бизнес-правило: Только администраторы могут удалять фильмы
   * Ограничение: Нельзя удалить фильм, если есть связанные записи просмотров
   * Возвращает: Статус успешного удаления или ошибку о существующих связях

10. **`movie.search`** - Поиск фильмов
    * Бизнес-логика: Поиск фильмов по названию сначала в локальной базе, при отсутствии - запрос к TMDb API с последующим сохранением результатов в локальную базу
    * Фильтры: По названию, году выпуска, жанру
    * Возвращает: Список фильмов с базовой информацией
    * Кэширование: Найденные через TMDb фильмы сохраняются в локальную базу

## 3. Бизнес-правила

1. **Права доступа:**
   * Пользователи видят только свои записи
   * Администраторы имеют доступ ко всем данным для модерации
   * Гостевой доступ запрещен - требуется аутентификация

2. **Валидация данных:**
   * Оценка: целое число от 1 до 10
   * Дата просмотра: не позднее текущей даты
   * Комментарий: максимум 2000 символов
   * Название фильма: обязательное поле при создании через API

3. **Ограничения для пользователей:**
   * Лимит 60 запросов в минуту к API поиска фильмов (для защиты от злоупотребления TMDb API)
   * Лимит 100 запросов в минуту к остальным endpoints

4. **Работа с фильмами:**
   * Фильмы автоматически сохраняются в локальную базу при первом поиске через TMDb
   * При поиске сначала проверяется локальная база, затем TMDb
   * Все фильмы хранятся в локальной базе для быстрого доступа
   * Обновление информации о фильме возможно только администраторами

## 4. Бизнес-метрики успеха

1. **Скорость ответа API:** 95% запросов должны выполняться < 500 мс
2. **Доступность:** API доступен 99% времени
3. **Точность поиска:** Не менее 90% релевантных результатов в первых 10 результатах поиска
4. **Ограничения:**
   * Обычные пользователи: 100 запросов/минуту
   * Администраторы: без ограничений